<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GEMINI_V17_FINAL_PATCH</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');
        body { background: #000; color: #00ff41; font-family: 'Share Tech Mono', monospace; height: 100dvh; display: flex; flex-direction: column; overflow: hidden; }
        .hacker-border { border: 1px solid rgba(0, 255, 65, 0.5); background: rgba(0, 15, 0, 0.9); }
        .progress-bar { height: 4px; background: #002200; border-radius: 2px; overflow: hidden; margin-top: 10px; }
        #fill { height: 100%; width: 0%; background: #00ff41; box-shadow: 0 0 10px #00ff41; transition: width 0.2s; }
        #vid { width: 100%; border-radius: 4px; display: none; border: 1px solid #00441b; margin-top: 10px; }
        .log-box { font-size: 9px; color: #008f11; height: 100px; overflow-y: auto; border-top: 1px solid #111; padding-top: 5px; }
    </style>
</head>
<body class="p-4">

    <header class="flex justify-between items-center mb-4 border-b border-green-900 pb-2">
        <div class="flex items-center gap-2">
            <i data-lucide="shield-check" class="text-green-500"></i>
            <h1 class="text-xs font-bold tracking-[0.2em] uppercase">V17_FINAL_STABLE</h1>
        </div>
        <div class="text-[9px] font-bold text-red-500 bg-red-900/10 px-2 py-1 rounded">FIX: MODEL_NOT_FOUND</div>
    </header>

    <div class="flex-grow overflow-y-auto space-y-4 pr-1">
        <div class="hacker-border p-5 rounded-lg relative overflow-hidden">
            <input type="file" id="vidInp" accept="video/*" class="hidden" onchange="initVid(this)">
            <button onclick="document.getElementById('vidInp').click()" class="w-full bg-green-900/10 border border-green-500/30 py-8 font-black text-xs flex flex-col items-center gap-3">
                <i data-lucide="video" class="w-8 h-8"></i>
                <span>SELECT 2MIN VIDEO (50 FRAMES)</span>
            </button>
            <video id="vid" muted playsinline></video>
            <div class="progress-bar"><div id="fill"></div></div>
            <div id="status" class="text-[9px] text-right mt-1 opacity-50 italic">System: Waiting...</div>
        </div>

        <div id="terminal" class="log-box font-mono">
            <div>> Patch V17: Routing through models/gemini-1.5-flash...</div>
        </div>

        <button id="mainBtn" onclick="runUltraScan()" class="hidden w-full bg-green-600 text-black py-4 font-black rounded uppercase text-sm shadow-[0_0_20px_rgba(0,255,65,0.4)] transition-all">
            EXECUTE 50-FRAME MASTER SCAN
        </button>

        <div id="intel" class="hacker-border p-4 rounded-lg min-h-[160px] text-xs leading-relaxed mb-10 bg-black/50 overflow-y-auto max-h-[300px]">
            <div class="opacity-20 text-center mt-10 italic">AWAITING SYSTEM SIGNAL...</div>
        </div>
    </div>

    <canvas id="canvas" style="display:none;"></canvas>

    <script>
        lucide.createIcons();
        
        // --- FINAL REFINED CONFIG ---
        const KEY = "AIzaSyDsRjt-EHNElnlv3SbPN1HCM22RrL1dLcE";
        // Humne ab model path ko explicitly URL mein fix kar diya hai
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${KEY}`;

        function log(m, isErr = false) {
            const t = document.getElementById('terminal');
            t.innerHTML += `<div class="${isErr ? 'text-red-500' : ''}">> ${m}</div>`;
            t.scrollTop = t.scrollHeight;
        }

        function initVid(input) {
            if(!input.files[0]) return;
            const v = document.getElementById('vid');
            v.src = URL.createObjectURL(input.files[0]);
            v.style.display = 'block';
            v.onloadedmetadata = () => {
                document.getElementById('mainBtn').classList.remove('hidden');
                log("VIDEO_READY: Duration " + v.duration.toFixed(1) + "s locked.");
            };
        }

        async function runUltraScan() {
            const v = document.getElementById('vid');
            const btn = document.getElementById('mainBtn');
            const bar = document.getElementById('fill');
            const canv = document.getElementById('canvas');
            const ctx = canv.getContext('2d');
            const intel = document.getElementById('intel');

            btn.disabled = true;
            btn.innerText = "CRACKING IN PROGRESS...";
            intel.innerHTML = "<div class='text-green-500 animate-pulse text-center mt-10'>SCRAPING 50 KEYFRAMES...</div>";

            const frames = [];
            const steps = 50; 
            const gap = v.duration / (steps + 1);

            try {
                for(let i=1; i<=steps; i++) {
                    v.currentTime = i * gap;
                    await new Promise(r => v.onseeked = r);
                    
                    // Optimization: 480px width for massive 50-frame stability
                    const targetW = 480; 
                    const scale = targetW / v.videoWidth;
                    canv.width = targetW;
                    canv.height = v.videoHeight * scale;
                    
                    ctx.drawImage(v, 0, 0, canv.width, canv.height);
                    frames.push(canv.toDataURL('image/jpeg', 0.3).split(',')[1]);
                    
                    bar.style.width = (i/steps)*100 + '%';
                    document.getElementById('status').innerText = `Buffer: ${i}/50 Frames`;
                    if(i % 10 === 0) log(`CACHING: Frame ${i} stored.`);
                }

                log("TRANSMITTING: Bypassing X99 model error...");

                const payload = {
                    contents: [{
                        parts: [
                            { text: "INSTRUCTIONS: You are a professional password extractor. These are 50 chronological frames from a 2-minute video. Carefully look at every pixel. If a password, zip code, or key is shown, extract it immediately. Output ONLY the password." },
                            ...frames.map(f => ({ inline_data: { mime_type: "image/jpeg", data: f } }))
                        ]
                    }]
                };

                const res = await fetch(API_URL, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(payload)
                });

                const data = await res.json();
                
                if(data.error) {
                    // Agar ab bhi error aaye, toh manual model path try karenge
                    throw new Error(data.error.message);
                }

                const result = data.candidates[0].content.parts[0].text;
                intel.innerHTML = `<div class="text-red-500 font-bold mb-2 underline">[EXTRACTED_DATA]</div><div class="text-white bg-green-950/20 p-3 rounded border border-green-500/20">${result}</div>`;
                log("SUCCESS: Mission accomplished.");

            } catch(e) {
                log("FATAL_ERROR: " + e.message, true);
                intel.innerHTML = `<div class="text-red-600 font-bold uppercase">Critical_Failure:</div><div class="text-[10px] text-white mt-1 italic">${e.message}</div>`;
            } finally {
                btn.disabled = false;
                btn.innerText = "EXECUTE 50-FRAME MASTER SCAN";
            }
        }
    </script>
</body>
</html>
