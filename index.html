<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>TITAN_V22_QUAD_API_SCAN</title>
   <script src="https://cdn.tailwindcss.com"></script>
   <script src="https://unpkg.com/lucide@latest"></script>
   <style>
       @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');
       body { background: #000; color: #00ff41; font-family: 'Share Tech Mono', monospace; height: 100dvh; display: flex; flex-direction: column; overflow: hidden; }
       .hacker-panel { border: 1px solid #00ff41; background: rgba(0, 30, 0, 0.4); box-shadow: 0 0 15px rgba(0,255,65,0.2); }
       .progress-box { height: 12px; background: #001a00; border-radius: 6px; overflow: hidden; border: 1px solid #00ff41; }
       #fill { height: 100%; width: 0%; background: linear-gradient(90deg, #00441b, #00ff41); transition: width 0.1s; }
       #vid { width: 100%; display: none; margin-top: 10px; border: 1px solid #00ff41; border-radius: 8px; }
       .terminal { font-size: 10px; color: #00ff41; height: 140px; overflow-y: auto; background: #050505; padding: 10px; border: 1px solid #00441b; }
       .api-indicator { display: inline-block; width: 8px; height: 8px; border-radius: 50%; margin-right: 6px; }
       .api-active { background: #00ff41; box-shadow: 0 0 8px #00ff41; }
       .api-waiting { background: #555; }
       .api-error { background: #ff0041; box-shadow: 0 0 8px #ff0041; }
   </style>
</head>
<body class="p-4">

   <header class="flex justify-between items-center mb-4 border-b border-green-800 pb-2">
       <h1 class="text-xs font-bold tracking-[0.4em] uppercase flex items-center gap-2">
           <i data-lucide="shield-alert" class="text-red-500 animate-pulse"></i> TITAN_V22_QUAD
       </h1>
       <div class="flex gap-2 text-[10px]">
           <span class="flex items-center"><span class="api-indicator api-active" id="ind0"></span>G1</span>
           <span class="flex items-center"><span class="api-indicator api-waiting" id="ind1"></span>G2</span>
           <span class="flex items-center"><span class="api-indicator api-waiting" id="ind2"></span>G3</span>
           <span class="flex items-center"><span class="api-indicator api-waiting" id="ind3"></span>OR</span>
       </div>
   </header>

   <div class="flex-grow space-y-4 overflow-y-auto pr-1">
       <div class="hacker-panel p-5 rounded-2xl relative">
           <input type="file" id="vidFile" accept="video/*" class="hidden" onchange="loadVid(this)">
           <button onclick="document.getElementById('vidFile').click()" class="w-full py-10 border-2 border-dashed border-green-600 rounded-xl flex flex-col items-center gap-3 hover:bg-green-900/30 transition-all">
               <i data-lucide="database" class="w-12 h-12"></i>
               <span class="text-xs font-black uppercase">Inject 10-Minute Video Payload</span>
           </button>
           <video id="vid" muted playsinline></video>
           
           <div class="progress-box mt-5"><div id="fill"></div></div>
           <div class="flex justify-between text-[10px] mt-2 font-bold uppercase">
               <span id="batchCount">Batch: 0/4</span>
               <span id="statusText">Total Frames: 0/200</span>
           </div>
       </div>

       <div id="logs" class="terminal font-mono scrollbar-hide">
           <div>> TITAN Kernel V22 Quad-API online...</div>
           <div>> 4 API Load Balancing Active (3xGemini + 1xOpenRouter)</div>
           <div>> Optimized for 10-minute long-duration analysis.</div>
       </div>

       <button id="mainBtn" onclick="runTitanScan()" class="hidden w-full bg-green-500 text-black py-5 font-black rounded uppercase text-sm shadow-[0_0_40px_rgba(0,255,65,0.5)]">
           Start 200-Frame Titan Crack
       </button>

       <div id="report" class="hacker-panel p-4 rounded-xl min-h-[180px] text-xs leading-relaxed mb-10 border-red-900/50">
           <span class="opacity-20 italic font-bold">Waiting for video signal decryption...</span>
       </div>
   </div>

   <canvas id="canvas" style="display:none;"></canvas>

   <script>
       lucide.createIcons();
       
       // 4 API Keys - 3 Gemini + 1 OpenRouter
       const API_KEYS = [
           "AIzaSyBcqimHqJ6QmtiqaSEjmN0vzCG5A6ZbqYY",  // Gemini 1
           "AIzaSyDJGqVi2R_5kwe1ZTZI8ML4EyYsMQV5Mhc",  // Gemini 2
           "AIzaSyBdQAoomzHAPSLlpjYgFDbrtdLyF1Mwl1g",  // Gemini 3
           "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"  // OpenRouter
       ];
       
       const API_NAMES = ["Gemini-1", "Gemini-2", "Gemini-3", "OpenRouter"];
       const IS_GEMINI = [true, true, true, false];
       
       let currentApiIndex = 0;
       let apiFailCount = [0, 0, 0, 0];

       function addLog(m, isErr = false) {
           const l = document.getElementById('logs');
           const time = new Date().toLocaleTimeString('en-US', {hour12: false});
           l.innerHTML += `<div class="${isErr ? 'text-red-500' : ''}">[${time}] ${m}</div>`;
           l.scrollTop = l.scrollHeight;
       }

       function setApiStatus(idx, status) {
           const el = document.getElementById(`ind${idx}`);
           el.className = 'api-indicator';
           if (status === 'active') el.classList.add('api-active');
           else if (status === 'error') el.classList.add('api-error');
           else el.classList.add('api-waiting');
       }

       function loadVid(input) {
           const v = document.getElementById('vid');
           v.src = URL.createObjectURL(input.files[0]);
           v.style.display = 'block';
           v.onloadedmetadata = () => {
               document.getElementById('mainBtn').classList.remove('hidden');
               addLog(`TARGET_LOCKED: ${v.duration.toFixed(1)}s (10-Min Ready)`);
           };
       }

       // Get next available API with rotation
       function getNextApi() {
           let attempts = 0;
           while (attempts < 4) {
               const idx = currentApiIndex;
               currentApiIndex = (currentApiIndex + 1) % 4;
               if (apiFailCount[idx] < 3) {
                   return idx;
               }
               attempts++;
           }
           return -1; // All failed
       }

       async function callGemini(apiIdx, prompt, base64Images) {
           const key = API_KEYS[apiIdx];
           const contents = [
               { role: "user", parts: [{ text: prompt }] }
           ];
           
           // Add images - Gemini supports multiple images per request
           base64Images.forEach(b64 => {
               contents[0].parts.push({
                   inlineData: {
                       mimeType: "image/jpeg",
                       data: b64.split(',')[1]
                   }
               });
           });

           const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${key}`, {
               method: "POST",
               headers: { "Content-Type": "application/json" },
               body: JSON.stringify({
                   contents: contents,
                   generationConfig: { temperature: 0.1, maxOutputTokens: 1000 }
               })
           });

           if (!res.ok) {
               const err = await res.text();
               throw new Error(`Gemini HTTP ${res.status}: ${err}`);
           }

           const data = await res.json();
           if (data.error) throw new Error(data.error.message);
           return data.candidates[0].content.parts[0].text;
       }

       async function callOpenRouter(apiIdx, prompt, base64Images) {
           const key = API_KEYS[apiIdx];
           
           // OpenRouter: Reduce to 10 images max per request to avoid payload limits
           const reducedImages = base64Images.slice(0, 10);
           
           const content = [{ type: "text", text: prompt + ` (Analyzing ${reducedImages.length} frames)` }];
           reducedImages.forEach(b64 => {
               content.push({ type: "image_url", image_url: { url: b64 } });
           });

           const res = await fetch("https://openrouter.ai/api/v1/chat/completions", {
               method: "POST",
               headers: { 
                   "Authorization": `Bearer ${key}`, 
                   "Content-Type": "application/json",
                   "HTTP-Referer": window.location.href,
                   "X-Title": "TITAN_V22"
               },
               body: JSON.stringify({ 
                   model: "google/gemini-2.0-flash-exp:free",
                   messages: [{ role: "user", content: content }],
                   max_tokens: 1000
               })
           });

           if (!res.ok) {
               const err = await res.text();
               throw new Error(`OpenRouter HTTP ${res.status}: ${err}`);
           }

           const data = await res.json();
           if (data.error) throw new Error(data.error.message);
           return data.choices[0].message.content;
       }

       async function analyzeBatch(apiIdx, prompt, base64Images) {
           setApiStatus(apiIdx, 'active');
           try {
               let result;
               if (IS_GEMINI[apiIdx]) {
                   result = await callGemini(apiIdx, prompt, base64Images);
               } else {
                   result = await callOpenRouter(apiIdx, prompt, base64Images);
               }
               setApiStatus(apiIdx, 'waiting');
               return { success: true, result, api: API_NAMES[apiIdx] };
           } catch (e) {
               apiFailCount[apiIdx]++;
               setApiStatus(apiIdx, 'error');
               addLog(`${API_NAMES[apiIdx]} FAILED: ${e.message}`, true);
               return { success: false, error: e.message };
           }
       }

       async function runTitanScan() {
           const v = document.getElementById('vid');
           const btn = document.getElementById('mainBtn');
           const fill = document.getElementById('fill');
           const report = document.getElementById('report');
           const canv = document.getElementById('canvas');
           const ctx = canv.getContext('2d');

           btn.disabled = true;
           btn.innerText = "CRACKING 10-MIN PAYLOAD...";
           report.innerHTML = "";
           
           // Reset API states
           apiFailCount = [0, 0, 0, 0];
           for(let i=0; i<4; i++) setApiStatus(i, 'waiting');

           const totalFrames = 200;
           const batchSize = 25; // Reduced for stability
           const totalBatches = totalFrames / batchSize;
           const gap = v.duration / (totalFrames + 1);
           
           let results = [];

           try {
               for(let b = 0; b < totalBatches; b++) {
                   document.getElementById('batchCount').innerText = `Batch: ${b + 1}/${totalBatches}`;
                   addLog(`SCRAPING_BATCH: ${b + 1}/${totalBatches}`);
                   
                   const batchImages = [];
                   
                   for(let i = 1; i <= batchSize; i++) {
                       const currentIdx = (b * batchSize) + i;
                       v.currentTime = currentIdx * gap;
                       await new Promise(r => v.onseeked = r);
                       
                       canv.width = 320; // Reduced resolution
                       canv.height = v.videoHeight * (320 / v.videoWidth);
                       ctx.drawImage(v, 0, 0, canv.width, canv.height);
                       
                       batchImages.push(canv.toDataURL('image/jpeg', 0.3));
                       
                       const prog = (currentIdx / totalFrames) * 100;
                       fill.style.width = prog + '%';
                       document.getElementById('statusText').innerText = `Captured: ${currentIdx}/${totalFrames}`;
                   }

                   const prompt = `STRICT: Analyze these ${batchSize} frames from a 10-minute video. Find any hidden password, key, or secret code. Be very precise. Output ONLY the password/key or 'NOT_FOUND'.`;
                   
                   // Try APIs in rotation until one succeeds
                   let success = false;
                   let attempts = 0;
                   let batchResult = "ALL_APIS_FAILED";
                   
                   while (attempts < 4 && !success) {
                       const apiIdx = getNextApi();
                       if (apiIdx === -1) break;
                       
                       addLog(`Trying ${API_NAMES[apiIdx]} for Batch ${b+1}...`);
                       const res = await analyzeBatch(apiIdx, prompt, batchImages);
                       
                       if (res.success) {
                           batchResult = `[${res.api}] ${res.result}`;
                           success = true;
                           addLog(`BATCH_${b+1}_SUCCESS via ${res.api}`);
                       }
                       attempts++;
                   }

                   if (!success) {
                       batchResult = "ERROR: All API endpoints failed";
                       addLog(`BATCH_${b+1}_CRITICAL_FAIL`, true);
                   }

                   results.push(`<div class="mb-2 p-2 border-l-2 border-green-500 bg-green-900/10">Batch ${b+1}: ${batchResult}</div>`);
               }

               report.innerHTML = `<div class="text-red-500 font-bold underline mb-3 uppercase tracking-tighter text-center">Titan Deep Scan Final Intel</div>` + results.join('');
               addLog("TITAN_DEEP_SCAN_COMPLETE.");

           } catch(e) {
               addLog("FATAL_ERROR: " + e.message, true);
               report.innerHTML = `<div class="text-red-600 font-black">CRITICAL_FAIL: ${e.message}</div>`;
           } finally {
               btn.disabled = false;
               btn.innerText = "Start 200-Frame Titan Crack";
           }
       }
   </script>
</body>
</html>
